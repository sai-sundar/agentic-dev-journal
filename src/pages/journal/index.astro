---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const allPosts = (await getCollection('journal'))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

// Group posts by year
const postsByYear = allPosts.reduce((acc, post) => {
  const year = post.data.date.getFullYear();
  if (!acc[year]) acc[year] = [];
  acc[year].push(post);
  return acc;
}, {} as Record<number, typeof allPosts>);

const years = Object.keys(postsByYear).sort((a, b) => Number(b) - Number(a));
---

<BaseLayout title="Archive - Dev Journal">
  <h1>Archive</h1>
  <p style="color: var(--text-muted); margin-bottom: 2rem;">
    All {allPosts.length} entries from my development journey.
  </p>

  {years.map((year) => (
    <section style="margin-bottom: 2rem;">
      <h2>{year}</h2>
      <div class="entry-list">
        {postsByYear[Number(year)].map((post) => (
          <article class="entry-card">
            <h3 style="margin-top: 0;">
              <a href={`/agentic-dev-journal/journal/${post.slug}`}>{post.data.title}</a>
            </h3>
            <div class="entry-meta">
              <time datetime={post.data.date.toISOString()}>
                {post.data.date.toLocaleDateString('en-US', { month: 'long', day: 'numeric' })}
              </time>
              {post.data.tags.length > 0 && (
                <div class="tags">
                  {post.data.tags.map((tag) => (
                    <a href={`/agentic-dev-journal/tags/${tag}`} class="tag">#{tag}</a>
                  ))}
                </div>
              )}
            </div>
            <p>{post.data.description}</p>
          </article>
        ))}
      </div>
    </section>
  ))}
</BaseLayout>
